(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-648d"],{"/r2A":function(e,t,r){},"2alY":function(e,t,r){"use strict";var n=r("gNFt");r.n(n).a},Et1E:function(e,t,r){"use strict";var n=r("/r2A");r.n(n).a},P7iO:function(e,t,r){"use strict";var n=r("14Xm"),a=r.n(n),s=r("D3Ub"),i=r.n(s),o={name:"AddressSelect",props:{service:{type:String,required:!0},label:{type:String,required:!0},placeholder:{type:String,default:""},value:{type:Array|Number,default:function(){return[]}},bind:{type:Object,default:function(){return{}}}},data:function(){return{address:{},addresses:[],addressSearch:""}},watch:{value:{handler:function(e){this.address=e},deep:!0,immediate:!0}},methods:{fetchAddresses:function(){var e=this;return i()(a.a.mark(function t(){var r,n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={$limit:-1},e.addressSearch&&(r.$search=e.addressSearch),t.next=4,e.$apiClient.service(e.service).find({query:r});case 4:n=t.sent,Array.isArray(n)?e.addresses=n:e.addresses=n.data;case 6:case"end":return t.stop()}},t,e)}))()},resetAddresses:function(e){this.addressSearch=e,this.addresses=[],this.fetchAddresses()},addressChanged:function(e){this.address=e,this.$emit("value-changed",this.address)}}},c=(r("Et1E"),r("KHd+")),u=Object(c.a)(o,function(){var e=this,t=e.$createElement;return(e._self._c||t)("v-select",e._b({attrs:{value:e.address,label:e.label,reduce:function(e){return e.id},options:e.addresses,fetchData:e.fetchAddresses,taggable:!1,clearable:!1,"infinite-loading":!1,placeholder:e.placeholder},on:{search:e.resetAddresses,input:e.addressChanged}},"v-select",e.bind,!1))},[],!1,null,null,null);u.options.__file="index.vue";t.a=u.exports},fVKT:function(e,t,r){"use strict";var n=r("4d7F"),a=r.n(n);t.a={methods:{validateForm:function(e){var t=this;return new a.a(function(r,n){t.$refs[e].validate(function(e){e?r(e):(t.$message({message:"Данные заполнены неверно",type:"error"}),n(e))})})}}}},gNFt:function(e,t,r){},hwwj:function(e,t,r){"use strict";var n=r("14Xm"),a=r.n(n),s=r("D3Ub"),i=r.n(s);t.a={methods:{confirmUpdate:function(e,t){var r=this;return i()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$confirm(e,"Предупреждение",{confirmButtonText:"Да",cancelButtonText:"Нет",type:"warning"});case 3:n.next=9;break;case 5:throw n.prev=5,n.t0=n.catch(0),r.$message({message:t}),new Error(n.t0);case 9:case"end":return n.stop()}},n,r,[[0,5]])}))()}}}},pJ1W:function(e,t,r){"use strict";r.r(t);var n=r("QbLZ"),a=r.n(n),s=r("14Xm"),i=r.n(s),o=r("D3Ub"),c=r.n(o),u=r("fVKT"),l=r("hwwj"),d=r("sJ1T"),p=r("P7iO"),f={name:"SpecializationForm",components:{cropUpload:d.a,AsyncSelect:p.a},mixins:[u.a,l.a],data:function(){return{form:{name:"",type:""},show:!1,isEdit:!1,rules:{name:[{required:!0,message:"Введите название специализаци",trigger:"blur"}]},imageUrl:""}},mounted:function(){this.$route.params.id&&(this.isEdit=!0,this.fetchData())},methods:{fetchData:function(){var e=this;return c()(i.a.mark(function t(){var r,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$apiClient.service("specializations"),t.next=3,r.get(e.$route.params.id);case 3:n=t.sent,e.form=n,e.form.iconId&&(e.imageUrl=e.form.icon,e.oldIcon=e.form.iconId);case 6:case"end":return t.stop()}},t,e)}))()},onEdit:function(){var e=this;return c()(i.a.mark(function t(){var r,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.validateForm("ruleForm");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:return t.prev=8,t.next=11,e.confirmUpdate("Сохранить изменения специализаци?","Специализация не изменена");case 11:t.next=16;break;case 13:return t.prev=13,t.t1=t.catch(8),t.abrupt("return",!1);case 16:return r=e.$apiClient.service("specializations"),t.next=19,r.patch(e.$route.params.id,a()({},e.form));case 19:if(null===e.oldIcon){t.next=29;break}return n=e.$apiClient.service("files"),t.prev=21,t.next=24,n.remove(e.oldIcon);case 24:t.next=29;break;case 26:t.prev=26,t.t2=t.catch(21),console.log(t.t2);case 29:e.$message({message:"Специализация изменена!",type:"success"}),e.$router.push({name:"Specializations"});case 31:case"end":return t.stop()}},t,e,[[0,5],[8,13],[21,26]])}))()},onAdd:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.validateForm("ruleForm");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:return r=e.$apiClient.service("specializations"),t.next=11,r.create(a()({},e.form));case 11:e.$message({message:"Специализация сохранена!",type:"success"}),e.$router.push({name:"Specializations"});case 13:case"end":return t.stop()}},t,e,[[0,5]])}))()},hideLogo:function(){this.form.iconId=null,this.imageUrl=""},deleteLogo:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$apiClient.service("files"),t.next=3,r.remove(e.form.iconId);case 3:e.form.iconId=null,e.imageUrl="";case 5:case"end":return t.stop()}},t,e)}))()},onCancel:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.confirmUpdate("Оменить изменения специализаци?","Продолжайте редактирование специализаци");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:if(e.$message({message:"Специализация не изменена!",type:"warning"}),!e.isEdit||null===e.form.iconId||e.form.iconId===e.oldIcon){t.next=12;break}return t.next=12,e.deleteLogo();case 12:if(e.isEdit||null===e.form.iconId||!e.form.iconId){t.next=15;break}return t.next=15,e.deleteLogo();case 15:e.$router.push({name:"Specializations"});case 16:case"end":return t.stop()}},t,e,[[0,5]])}))()},handleImageDataUrl:function(e){this.imageUrl=e},handleAvatarSuccess:function(e){var t=this;return c()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.form.iconId||t.form.iconId===t.oldIcon){r.next=3;break}return r.next=3,t.deleteLogo();case 3:t.form.iconId=e[0]._id,t.imageUrl="https://skfu.spichka.dev/api/v1/uploads/"+e[0].filename;case 5:case"end":return r.stop()}},r,t)}))()},toggleShow:function(){this.show=!this.show}}},m=(r("2alY"),r("KHd+")),h=Object(m.a)(f,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"160px"}},[r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{prop:"name",label:"Название"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{prop:"type",label:"Тип"}},[r("el-select",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[r("el-option",{attrs:{label:"Основная",value:"main"}}),e._v(" "),r("el-option",{attrs:{label:"Подспециализация",value:"sub"}})],1)],1)],1)],1),e._v(" "),"sub"===e.form.type?r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"Специализация"}},[r("AsyncSelect",{attrs:{service:"specializations",label:"name",value:e.form.specializationId,multiple:!1},on:{"value-changed":function(t){return e.form.specializationId=t}}})],1)],1)],1):e._e(),e._v(" "),r("el-form-item",[e.isEdit?r("el-button",{attrs:{type:"primary"},on:{click:e.onEdit}},[e._v("\n        Изменить\n      ")]):e._e(),e._v(" "),e.isEdit?e._e():r("el-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("\n        Cохранить\n      ")]),e._v(" "),r("el-button",{on:{click:e.onCancel}},[e._v("Отмена")])],1)],1)],1)},[],!1,null,null,null);h.options.__file="SpecializationForm.vue";t.default=h.exports},sJ1T:function(e,t,r){"use strict";var n=r("QbLZ"),a=r.n(n),s=r("L2JU"),i={name:"CropUpload",components:{cropUpload:r("C03Y").a},props:{show:{type:Boolean,default:!1}},data:function(){return{fileUrl:"https://skfu.spichka.dev/api/v1/files/",componentShow:!1}},computed:a()({},Object(s.c)({token:"user/token"}),{headerInfo:function(){return{Authorization:"Bearer "+this.token}}}),watch:{show:function(){this.componentShow=this.show}},methods:{handleImageDataUrl:function(e){this.$emit("update-image-url",e)},handleAvatarSuccess:function(e){this.$emit("image-loaded",e)}}},o=r("KHd+"),c=Object(o.a)(i,function(){var e=this,t=e.$createElement;return(e._self._c||t)("crop-upload",{attrs:{width:800,height:600,url:e.fileUrl,headers:e.headerInfo,"lang-type":"ru",field:"file","img-format":"png"},on:{"crop-success":e.handleImageDataUrl,"crop-upload-success":e.handleAvatarSuccess},model:{value:e.componentShow,callback:function(t){e.componentShow=t},expression:"componentShow"}})},[],!1,null,null,null);c.options.__file="index.vue";t.a=c.exports}}]);