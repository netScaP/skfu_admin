(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-20f2"],{"2KV4":function(e,t,r){},L9Cm:function(e,t,r){"use strict";var n=r("2KV4");r.n(n).a},fVKT:function(e,t,r){"use strict";var n=r("4d7F"),a=r.n(n);t.a={methods:{validateForm:function(e){var t=this;return new a.a(function(r,n){t.$refs[e].validate(function(e){e?r(e):(t.$message({message:"Данные заполнены неверно",type:"error"}),n(e))})})}}}},hwwj:function(e,t,r){"use strict";var n=r("14Xm"),a=r.n(n),o=r("D3Ub"),i=r.n(o);t.a={methods:{confirmUpdate:function(e,t){var r=this;return i()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r.$confirm(e,"Предупреждение",{confirmButtonText:"Да",cancelButtonText:"Нет",type:"warning"});case 3:n.next=9;break;case 5:throw n.prev=5,n.t0=n.catch(0),r.$message({message:t}),new Error(n.t0);case 9:case"end":return n.stop()}},n,r,[[0,5]])}))()}}}},lnqt:function(e,t,r){"use strict";r.r(t);var n=r("QbLZ"),a=r.n(n),o=r("14Xm"),i=r.n(o),s=r("D3Ub"),c=r.n(s),l=r("fVKT"),u=r("hwwj"),m={name:"CategoryForm",components:{cropUpload:r("sJ1T").a},mixins:[l.a,u.a],data:function(){return{form:{name:"",priority:"",isAvailable:!1,iconId:void 0},oldIcon:null,show:!1,isEdit:!1,rules:{name:[{required:!0,message:"Введите название категории",trigger:"blur"}]},imageUrl:""}},mounted:function(){this.$route.params.id&&(this.isEdit=!0,this.fetchData())},methods:{fetchData:function(){var e=this;return c()(i.a.mark(function t(){var r,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$apiClient.service("categories"),t.next=3,r.get(e.$route.params.id);case 3:n=t.sent,e.form=n,e.form.iconId&&(e.imageUrl=e.form.icon,e.oldIcon=e.form.iconId);case 6:case"end":return t.stop()}},t,e)}))()},onEdit:function(){var e=this;return c()(i.a.mark(function t(){var r,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.validateForm("ruleForm");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:return t.prev=8,t.next=11,e.confirmUpdate("Сохранить изменения категории?","Категория не изменена");case 11:t.next=16;break;case 13:return t.prev=13,t.t1=t.catch(8),t.abrupt("return",!1);case 16:return r=e.$apiClient.service("categories"),t.next=19,r.patch(e.$route.params.id,a()({},e.form));case 19:if(null===e.oldIcon){t.next=29;break}return n=e.$apiClient.service("files"),t.prev=21,t.next=24,n.remove(e.oldIcon);case 24:t.next=29;break;case 26:t.prev=26,t.t2=t.catch(21),console.log(t.t2);case 29:e.$message({message:"Категория изменена!",type:"success"}),e.$router.push({name:"Categories"});case 31:case"end":return t.stop()}},t,e,[[0,5],[8,13],[21,26]])}))()},onAdd:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.validateForm("ruleForm");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:return r=e.$apiClient.service("categories"),t.next=11,r.create(a()({},e.form));case 11:e.$message({message:"Категория сохранена!",type:"success"}),e.$router.push({name:"Categories"});case 13:case"end":return t.stop()}},t,e,[[0,5]])}))()},hideLogo:function(){this.form.iconId=null,this.imageUrl=""},deleteLogo:function(){var e=this;return c()(i.a.mark(function t(){var r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$apiClient.service("files"),t.next=3,r.remove(e.form.iconId);case 3:e.form.iconId=null,e.imageUrl="";case 5:case"end":return t.stop()}},t,e)}))()},onCancel:function(){var e=this;return c()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.confirmUpdate("Оменить изменения категории?","Продолжайте редактирование категории");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:if(e.$message({message:"Категория не изменена!",type:"warning"}),!e.isEdit||null===e.form.iconId||e.form.iconId===e.oldIcon){t.next=12;break}return t.next=12,e.deleteLogo();case 12:if(e.isEdit||null===e.form.iconId||!e.form.iconId){t.next=15;break}return t.next=15,e.deleteLogo();case 15:e.$router.push({name:"Categories"});case 16:case"end":return t.stop()}},t,e,[[0,5]])}))()},handleImageDataUrl:function(e){this.imageUrl=e},handleAvatarSuccess:function(e){var t=this;return c()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.form.iconId||t.form.iconId===t.oldIcon){r.next=3;break}return r.next=3,t.deleteLogo();case 3:t.form.iconId=e[0]._id,t.imageUrl="https://api.coffeeincar.ru/api/v2/uploads/"+e[0].filename;case 5:case"end":return r.stop()}},r,t)}))()},toggleShow:function(){this.show=!this.show}}},p=(r("L9Cm"),r("KHd+")),f=Object(p.a)(m,function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"160px"}},[r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{prop:"name",label:"Название"}},[r("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"priority"}},[r("el-input-number",{model:{value:e.form.priority,callback:function(t){e.$set(e.form,"priority",t)},expression:"form.priority"}})],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"Активный"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.form.isAvailable,callback:function(t){e.$set(e.form,"isAvailable",t)},expression:"form.isAvailable"}})],1)],1)],1),e._v(" "),r("el-form-item",{staticClass:"avatar-uploader",attrs:{label:"Лого"}},[e.imageUrl?r("img",{staticClass:"avatar",staticStyle:{cursor:"pointer"},attrs:{src:e.imageUrl},on:{click:e.toggleShow}}):r("div",{staticClass:"avatar-uploader",on:{click:e.toggleShow}},[r("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),e._v(" "),r("crop-upload",{attrs:{show:e.show},on:{input:e.toggleShow,"update-image-url":e.handleImageDataUrl,"image-loaded":e.handleAvatarSuccess}}),e._v(" "),e.form.iconId||""!==e.imageUrl?r("el-button",{attrs:{type:"danger"},on:{click:e.hideLogo}},[e._v("\n        Удалить иконку\n      ")]):e._e()],1),e._v(" "),r("el-form-item",[e.isEdit?r("el-button",{attrs:{type:"primary"},on:{click:e.onEdit}},[e._v("\n        Изменить\n      ")]):e._e(),e._v(" "),e.isEdit?e._e():r("el-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("\n        Cохранить\n      ")]),e._v(" "),r("el-button",{on:{click:e.onCancel}},[e._v("Отмена")])],1)],1)],1)},[],!1,null,null,null);f.options.__file="CategoryForm.vue";t.default=f.exports},sJ1T:function(e,t,r){"use strict";var n=r("QbLZ"),a=r.n(n),o=r("L2JU"),i={name:"CropUpload",components:{cropUpload:r("C03Y").a},props:{show:{type:Boolean,default:!1}},data:function(){return{fileUrl:"https://api.coffeeincar.ru/api/v2/files/",componentShow:!1}},computed:a()({},Object(o.c)({token:"user/token"}),{headerInfo:function(){return{Authorization:"Bearer "+this.token}}}),watch:{show:function(){this.componentShow=this.show}},methods:{handleImageDataUrl:function(e){this.$emit("update-image-url",e)},handleAvatarSuccess:function(e){this.$emit("image-loaded",e)}}},s=r("KHd+"),c=Object(s.a)(i,function(){var e=this,t=e.$createElement;return(e._self._c||t)("crop-upload",{attrs:{width:800,height:600,url:e.fileUrl,headers:e.headerInfo,"lang-type":"ru",field:"file","img-format":"png"},on:{"crop-success":e.handleImageDataUrl,"crop-upload-success":e.handleAvatarSuccess},model:{value:e.componentShow,callback:function(t){e.componentShow=t},expression:"componentShow"}})},[],!1,null,null,null);c.options.__file="index.vue";t.a=c.exports}}]);