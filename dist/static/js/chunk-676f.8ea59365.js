(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-676f"],{BP97:function(e,t,n){"use strict";var a=n("WfUp");n.n(a).a},RGjw:function(e,t,n){"use strict";n.r(t);var a=n("m1cH"),r=n.n(a),s=n("14Xm"),i=n.n(s),c=n("D3Ub"),l=n.n(c),o={name:"Users",mixins:[n("hwwj").a],data:function(){return{users:[],searchField:"",isLoading:!0,total:1,limit:10,page:1}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var e=this;return l()(i.a.mark(function t(){var n,a,r,s,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,n=e.$apiClient.service("users"),a={$limit:e.limit,$skip:e.page-1?(e.page-1)*e.limit:0,$byPermissions:!0},""!==e.searchField&&(a.email={$search:e.searchField}),t.next=6,n.find({query:a});case 6:if(r=t.sent,s=r.data,c=r.total,!(0===s.length&&e.page>1)){t.next=13;break}return e.page-=1,t.next=12,e.fetchData();case 12:return t.abrupt("return",t.sent);case 13:return e.users=s,e.total=c,e.isLoading=!1,t.abrupt("return",!0);case 17:case"end":return t.stop()}},t,e)}))()},handleSizeChange:function(e){this.limit=e,this.fetchData()},updateActive:function(e,t,n){var a=e.isConfirmed,s=this;return l()(i.a.mark(function e(){var c,l,o,u,d;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=a?"Подтвердить аккаунт этого пользователя?":"Убрать подтверждение этого аккаунта?",l=a?"Аккаунт не подтвержден":"Аккаунт остался подтверждённым",e.next=5,s.confirmUpdate(c,l);case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",!1);case 10:return o=s.$apiClient.service("users"),e.next=13,o.patch(t,{isConfirmed:a});case 13:u=a?"Аккаунт подтверждён":"С аккаунта снято подтверждение",s.$message({message:u,type:"success"}),(d=[].concat(r()(s.users)))[n].isConfirmed=a,s.users=d;case 18:case"end":return e.stop()}},e,s,[[0,7]])}))()},handleDelete:function(e){var t=this;return l()(i.a.mark(function n(){var a;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.confirmUpdate("Точно удалить этот аккаунт?","Аккаунт удалён");case 3:n.next=8;break;case 5:return n.prev=5,n.t0=n.catch(0),n.abrupt("return",!1);case 8:return a=t.$apiClient.service("users"),n.prev=9,n.next=12,a.remove(e);case 12:return t.$message({message:"Аккаунт удалён",type:"success"}),n.next=15,t.fetchData();case 15:return n.abrupt("return",n.sent);case 18:n.prev=18,n.t1=n.catch(9),t.$message({message:"Не удалось удалить аккаунт",type:"warning"});case 21:case"end":return n.stop()}},n,t,[[0,5],[9,18]])}))()}}},u=(n("BP97"),n("KHd+")),d=Object(u.a)(o,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"top-menu el-col el-col-24 el-col-xs-24 el-col-sm-24 el-col-md-24 tp-text--right mb-4"},[n("div",{staticClass:"filters"},[n("div",[n("el-input",{attrs:{clearable:"",placeholder:"E-mail"},model:{value:e.searchField,callback:function(t){e.searchField=t},expression:"searchField"}},[n("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){e.fetchData()}},slot:"append"})],1)],1)])]),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],attrs:{data:e.users,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{align:"center",label:"ID",width:"95"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.$index)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"Имя","min-width":"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.name)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"E-mail",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.email)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"Роль",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.type)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{align:"center",label:"Доступы","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.permissions,function(t,a){return n("p",{key:a},[e._v("\n          "+e._s(t)+"\n        ")])})}}])}),e._v(" "),n("el-table-column",{attrs:{fixed:"right",label:"Действия","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"el-button-group"},[t.row.isConfirmed?n("el-button",{attrs:{size:"small"},on:{click:function(n){e.updateActive({isConfirmed:!1},t.row._id,t.$index)}}},[e._v("\n            Убрать подтверждение\n          ")]):n("el-button",{attrs:{size:"small"},on:{click:function(n){e.updateActive({isConfirmed:!0},t.row._id,t.$index)}}},[e._v("\n            Подтвердить\n          ")]),e._v(" "),n("el-button",{attrs:{size:"small"},on:{click:function(n){e.handleDelete(t.row._id)}}},[n("i",{staticClass:"el-icon-delete"})])],1)]}}])})],1),e._v(" "),n("el-pagination",{attrs:{"current-page":e.page,"page-size":e.limit,total:e.total,"page-sizes":[10,20,50],background:"",layout:"sizes, prev, pager, next, total"},on:{"update:currentPage":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.fetchData}})],1)},[],!1,null,"cd621da8",null);d.options.__file="index.vue";t.default=d.exports},WfUp:function(e,t,n){},hwwj:function(e,t,n){"use strict";var a=n("14Xm"),r=n.n(a),s=n("D3Ub"),i=n.n(s);t.a={methods:{confirmUpdate:function(e,t){var n=this;return i()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,n.$confirm(e,"Предупреждение",{confirmButtonText:"Да",cancelButtonText:"Нет",type:"warning"});case 3:a.next=9;break;case 5:throw a.prev=5,a.t0=a.catch(0),n.$message({message:t}),new Error(a.t0);case 9:case"end":return a.stop()}},a,n,[[0,5]])}))()}}}}}]);