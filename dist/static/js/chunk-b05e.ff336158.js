(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b05e"],{"1RLL":function(e,t,n){},"6sOH":function(e,t,n){"use strict";var r=n("1RLL");n.n(r).a},MfVn:function(e,t,n){"use strict";n.r(t);var r=n("QbLZ"),a=n.n(r),o=n("14Xm"),s=n.n(o),c=n("D3Ub"),i=n.n(c),u=n("fVKT"),l=n("hwwj"),m={name:"TagForm",components:{cropUpload:n("sJ1T").a},mixins:[u.a,l.a],data:function(){return{form:{name:"",type:""},show:!1,isEdit:!1,rules:{name:[{required:!0,message:"Введите название тега",trigger:"blur"}]},imageUrl:""}},mounted:function(){this.$route.params.id&&(this.isEdit=!0,this.fetchData())},methods:{fetchData:function(){var e=this;return i()(s.a.mark(function t(){var n,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$apiClient.service("tags"),t.next=3,n.get(e.$route.params.id);case 3:r=t.sent,e.form=r,e.form.iconId&&(e.imageUrl=e.form.icon,e.oldIcon=e.form.iconId);case 6:case"end":return t.stop()}},t,e)}))()},onEdit:function(){var e=this;return i()(s.a.mark(function t(){var n,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.validateForm("ruleForm");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:return t.prev=8,t.next=11,e.confirmUpdate("Сохранить изменения тег?","Тег не изменена");case 11:t.next=16;break;case 13:return t.prev=13,t.t1=t.catch(8),t.abrupt("return",!1);case 16:return n=e.$apiClient.service("tags"),t.next=19,n.patch(e.$route.params.id,a()({},e.form));case 19:if(null===e.oldIcon){t.next=29;break}return r=e.$apiClient.service("files"),t.prev=21,t.next=24,r.remove(e.oldIcon);case 24:t.next=29;break;case 26:t.prev=26,t.t2=t.catch(21),console.log(t.t2);case 29:e.$message({message:"Тег изменена!",type:"success"}),e.$router.push({name:"Tags"});case 31:case"end":return t.stop()}},t,e,[[0,5],[8,13],[21,26]])}))()},onAdd:function(){var e=this;return i()(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.validateForm("ruleForm");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:return n=e.$apiClient.service("tags"),t.next=11,n.create(a()({},e.form));case 11:e.$message({message:"Тег сохранена!",type:"success"}),e.$router.push({name:"Tags"});case 13:case"end":return t.stop()}},t,e,[[0,5]])}))()},hideLogo:function(){this.form.iconId=null,this.imageUrl=""},deleteLogo:function(){var e=this;return i()(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$apiClient.service("files"),t.next=3,n.remove(e.form.iconId);case 3:e.form.iconId=null,e.imageUrl="";case 5:case"end":return t.stop()}},t,e)}))()},onCancel:function(){var e=this;return i()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.confirmUpdate("Оменить изменения тег?","Продолжайте редактирование тег");case 3:t.next=8;break;case 5:return t.prev=5,t.t0=t.catch(0),t.abrupt("return",!1);case 8:if(e.$message({message:"Тег не изменена!",type:"warning"}),!e.isEdit||null===e.form.iconId||e.form.iconId===e.oldIcon){t.next=12;break}return t.next=12,e.deleteLogo();case 12:if(e.isEdit||null===e.form.iconId||!e.form.iconId){t.next=15;break}return t.next=15,e.deleteLogo();case 15:e.$router.push({name:"Tags"});case 16:case"end":return t.stop()}},t,e,[[0,5]])}))()},handleImageDataUrl:function(e){this.imageUrl=e},handleAvatarSuccess:function(e){var t=this;return i()(s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.form.iconId||t.form.iconId===t.oldIcon){n.next=3;break}return n.next=3,t.deleteLogo();case 3:t.form.iconId=e[0]._id,t.imageUrl="https://skfu.spichka.dev/api/v1/uploads/"+e[0].filename;case 5:case"end":return n.stop()}},n,t)}))()},toggleShow:function(){this.show=!this.show}}},p=(n("6sOH"),n("KHd+")),f=Object(p.a)(m,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"160px"}},[n("el-row",[n("el-col",{attrs:{span:8}},[n("el-form-item",{attrs:{prop:"name",label:"Название"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),e._v(" "),n("el-form-item",[e.isEdit?n("el-button",{attrs:{type:"primary"},on:{click:e.onEdit}},[e._v("\n        Изменить\n      ")]):e._e(),e._v(" "),e.isEdit?e._e():n("el-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("\n        Cохранить\n      ")]),e._v(" "),n("el-button",{on:{click:e.onCancel}},[e._v("Отмена")])],1)],1)],1)},[],!1,null,null,null);f.options.__file="TagForm.vue";t.default=f.exports},fVKT:function(e,t,n){"use strict";var r=n("4d7F"),a=n.n(r);t.a={methods:{validateForm:function(e){var t=this;return new a.a(function(n,r){t.$refs[e].validate(function(e){e?n(e):(t.$message({message:"Данные заполнены неверно",type:"error"}),r(e))})})}}}},hwwj:function(e,t,n){"use strict";var r=n("14Xm"),a=n.n(r),o=n("D3Ub"),s=n.n(o);t.a={methods:{confirmUpdate:function(e,t){var n=this;return s()(a.a.mark(function r(){return a.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.$confirm(e,"Предупреждение",{confirmButtonText:"Да",cancelButtonText:"Нет",type:"warning"});case 3:r.next=9;break;case 5:throw r.prev=5,r.t0=r.catch(0),n.$message({message:t}),new Error(r.t0);case 9:case"end":return r.stop()}},r,n,[[0,5]])}))()}}}},sJ1T:function(e,t,n){"use strict";var r=n("QbLZ"),a=n.n(r),o=n("L2JU"),s={name:"CropUpload",components:{cropUpload:n("C03Y").a},props:{show:{type:Boolean,default:!1}},data:function(){return{fileUrl:"https://skfu.spichka.dev/api/v1/files/",componentShow:!1}},computed:a()({},Object(o.c)({token:"user/token"}),{headerInfo:function(){return{Authorization:"Bearer "+this.token}}}),watch:{show:function(){this.componentShow=this.show}},methods:{handleImageDataUrl:function(e){this.$emit("update-image-url",e)},handleAvatarSuccess:function(e){this.$emit("image-loaded",e)}}},c=n("KHd+"),i=Object(c.a)(s,function(){var e=this,t=e.$createElement;return(e._self._c||t)("crop-upload",{attrs:{width:800,height:600,url:e.fileUrl,headers:e.headerInfo,"lang-type":"ru",field:"file","img-format":"png"},on:{"crop-success":e.handleImageDataUrl,"crop-upload-success":e.handleAvatarSuccess},model:{value:e.componentShow,callback:function(t){e.componentShow=t},expression:"componentShow"}})},[],!1,null,null,null);i.options.__file="index.vue";t.a=i.exports}}]);